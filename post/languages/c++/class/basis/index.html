<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://xwlu.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://xwlu.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/light.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/syntax.css' />
    <title>Class Basis - My New Hugo Site</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">

    <link rel="stylesheet" href="https://xwlu.github.io/css/custom.css">
    <script type="text/javascript" src="https://xwlu.github.io/js/custom.js"></script>

    
    <meta name="description"
  content="Basis for C&#43;&#43; class" />
<meta name="keywords"
  content='blog, robotics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://xwlu.github.io/post/languages/c&#43;&#43;/class/basis/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Class Basis - My New Hugo Site" />
<meta name="twitter:description"
  content="Basis for C&#43;&#43; class" />
<meta name="twitter:site" content="https://xwlu.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://xwlu.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Class Basis - My New Hugo Site">
<meta property="og:description"
  content="Basis for C&#43;&#43; class" />
<meta property="og:url" content="https://xwlu.github.io/post/languages/c&#43;&#43;/class/basis/" />
<meta property="og:site_name" content="Class Basis" />
<meta property="og:image"
  content="https://xwlu.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2025-04-02 10:32:39 &#43;0800 CST" />











</head>


<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://xwlu.github.io/">
        <img class="octicon" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://xwlu.github.io/">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://xwlu.github.io/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://xwlu.github.io/">
                  <img class=" avatar-user"
                    src="/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://xwlu.github.io/">looyifan</a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="https://xwlu.github.io/post/languages/c&#43;&#43;/class/basis/">Class Basis</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Wed, 02 Apr 2025 10:32:39 &#43;0800"
                    class="no-wrap">
                    Wed, 02 Apr 2025 10:32:39 &#43;0800</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Wed, 02 Apr 2025 16:42:17 &#43;0800"
                    class="no-wrap">
                    Wed, 02 Apr 2025 16:42:17 &#43;0800</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      2084 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="结构体">结构体</h1>
<ul>
<li>仅有声明的结构体是不完整类型
<pre tabindex="0"><code>struct Str;
int main() {
  Str s;  // 编译不通过，只有声明没有定义，不知道Str的内部结构，占多大内存
  Str* s;  // 编译通过，指针的内存大小是固定的，不需要知道Str的内部结构和大小
}
</code></pre></li>
<li>结构体（以及类）的一处定义原则：翻译单元级别
<ul>
<li>下面这份代码是可以通过编译并运行的，两个相同的结构体在不同的编译单元</li>
<li>source.cpp的内容
<pre tabindex="0"><code>struct Str{
  int x;
};

void fun() {
  Str m_str;
}
</code></pre></li>
<li>main.cpp的内容
<pre tabindex="0"><code>struct Str {
  int x;
};

void fun();

int main() {
  fun();
  Str str;
}
</code></pre></li>
</ul>
</li>
</ul>
<h1 id="数据成员的声明与初始化">数据成员的声明与初始化</h1>
<ul>
<li>(C++11)数据成员可以使用decltype来声明其类型，但不能使用auto</li>
<li>数据成员的声明可以引入const、引用、指针等限定</li>
<li>数据成员会在构造对象时定义</li>
<li>(C++11)支持类内成员初始化</li>
<li>结构体支持聚合初始化，但不建议使用
<pre tabindex="0"><code>struct Str {
  int x;
  int y;
};
int main() {
  Str s{3, 4};
  // 上面的代码看起来没啥问题，但是万一哪天，结构体中的成员的顺序被移动了，或者x和y中间插入了一个新的成员，那么这里的聚合初始化都可能引发不想要的错误
}
</code></pre></li>
<li>为了解决上面的问题，C++20引入了指派初始化
<pre tabindex="0"><code>Str s{.x=3, .y=4};
</code></pre></li>
</ul>
<hr>
<h1 id="mutable限定符">mutable限定符</h1>
<pre tabindex="0"><code>struct Str {
  mutable int x;
  int y;
};
int main() {
  const Str s;
  s.x = 3;  // 编译通过
  s.y = 4;  // 编译不通过
}
</code></pre><hr>
<h1 id="静态数据成员">静态数据成员</h1>
<ul>
<li>
<p>多个对象之前共享的数据成员</p>
</li>
<li>
<p>定义方式的演化</p>
<ul>
<li>C++98：1. 类外定义 2. const静态成员的类内初始化
<pre tabindex="0"><code>struct Str {
  static int x;
  int y;

  const static array_size = 100;  // 如果没有使用const static，就无法定义Str，因为编译器不知道要分配多大的内存给对象
  int buffer[array_size];  // C++98会把这里的array_size直接替换成100
};

int Str::x;  // 这里的定义不能少

int main() {
  Str s1;
  Str s2;
  s1.x = 100;
  s2.x = 1;
  std::cout &lt;&lt; s1.x &lt;&lt; std::endl;  // 1

  std::cout &lt;&lt; &amp;(s1.array_size) &lt;&lt; std::endl;  // 编译不通过，因为C98标准的编译器直接把用到array_size的地方替换为100了，并没有真的分配一块内存来存放array_size
  // 如果一定要给它分配一个地址的话，需要在某个地方加一行定义：int Str::array_size;
}
</code></pre></li>
<li>C++17：内联静态成员的初始化
<pre tabindex="0"><code>struct Str {
  inline static int array_size = 100;  // 不需要const了，可修改
  int buffer[array_size];
};

std::cout &lt;&lt; &amp;(s1.array_size) &lt;&lt; std::endl;  // 编译通过
</code></pre></li>
</ul>
</li>
<li>
<p>静态数据成员可以使用auto推导类型</p>
<pre tabindex="0"><code>struct Str {
  inline static auto array_size = 100;
};
</code></pre></li>
<li>
<p>静态数据成员的访问</p>
<ul>
<li>str.x</li>
<li>str-&gt;x</li>
<li>Str::x</li>
</ul>
</li>
<li>
<p>在类的内部声明相同类型的静态数据成员</p>
<pre tabindex="0"><code>struct Str {
  Str s;  // 编译不通过，因为不知道要给Str分配多大内存，又是鸡蛋问题
  static Str s;  // 编译通过，因为它被所有的Str对象共享，所以它不属于任何一个对象，所以在构建Str对象的时候，不用考虑它所占的内存
};

Str Str::s;  // 如果没有这一行，编译能通过，但是link不行，因为s没有被定义，就没有对应的内存 

int main() {
  Str s1;
  Str s2;
  std::cout &lt;&lt; &amp;(s1.s) &lt;&lt; std::endl;
}
</code></pre></li>
<li>
<p>inline使用的注意点</p>
<ul>
<li>错误使用方法
<pre tabindex="0"><code>struct Str {
  inline static int x;  // 编译通过
  inline static Str s;  // 编译不通过，因为使用inline后，这里就不是声明而是定义了，但程序执行到这一行的时候Str还是不完全类型，所以无法完成定义的操作
};

int main() {
  Str s1;
  Str s2;
  std::cout &lt;&lt; &amp;(s1.s) &lt;&lt; std::endl;
}
</code></pre></li>
<li>正确使用方法
<pre tabindex="0"><code>struct Str {
  static Str s;
};

inline static Str::s;   

int main() {
  Str s1;
  Str s2;
  std::cout &lt;&lt; &amp;(s1.s) &lt;&lt; std::endl;
}
</code></pre></li>
</ul>
</li>
</ul>
<hr>
<h1 id="成员函数">成员函数</h1>
<ul>
<li>声明与定义
<ul>
<li>类内定义(隐式内联)
<pre tabindex="0"><code>// str.h
struct Str {
  int x;
  void fun() {}
};

// main.cc
#include &#34;str.h&#34;

//main2.cc
#include &#34;str.h&#34;
</code></pre></li>
<li>类内声明+类外定义
<pre tabindex="0"><code>// str.h
struct Str {
  int x;
  void fun();
};

// str.cc
void Str::fun() {}

// main.cc
#include &#34;str.h&#34;

// main2.cc
#include &#34;str.h&#34;
</code></pre><ul>
<li>错误示范
<pre tabindex="0"><code>// str.h
struct Str {
  int x;
  void fun();
};
void Str::fun() {}  // 报错，重复定义，不能简单将类外定义实现在头文件里，除非改成下面一行
inline void Str::fun() {}  // 通过，内联函数（也可以直接把fun的定义写在类内，隐式内联）

// main.cc
#include &#34;str.h&#34;

// main2.cc
#include &#34;str.h&#34;
</code></pre></li>
</ul>
</li>
<li>类与编译期的两遍处理
<ul>
<li>我们在定义类的时候，喜欢把成员函数放前面，成员变量放后面</li>
<li>当某些成员函数采用类内定义的时候，它用到的成员函数的定义还在后面</li>
<li>所以C++引入了两遍处理逻辑，看到类内定义的时候，只当作声明，等到把类的声明都过一遍之后再回来处理隐式内联函数的定义</li>
</ul>
</li>
<li>成员函数与尾随返回类型(trail returning type)
<pre tabindex="0"><code>// str.h
struct Str {
  using MyRes = int;
  MyRes fun();
  int x;
};

// str.cc
#include &#34;str.h&#34;
MyRes Str::fun() {  // 错误，MyRes是属于Str类域的，需要改成Str::MyRes
  return x;
}

auto Str::fun() -&gt; MyRes {  // 合法，因为编译器从前面的Str::已经知道我们在处理Str类内的成员函数了，因此后面的MyRes就会从Str类域里去找定义了
  return x;
}
</code></pre></li>
<li>成员函数与this指针
<ul>
<li>每一个成员函数被调用的时候，编译器都会隐式地传一个this指针进去，用于确定函数里的成员变量是属于哪个对象的。</li>
<li>基于const的成员函数重载
<ul>
<li>this是被const修饰的，所以你不能执行this = nullptr这种，但是你可以操作this指向的内容</li>
<li>如果在成员函数的末尾加上const，传入的参数就变成const Str* const this，此时this和它指向的内容都无法被修改
<pre tabindex="0"><code>struct Str {
  // 下面这两个函数能够形成重载，因为传入的this指针类型不一样
  void fun(int x);  // Str* const this
  void fun(int x) const;  // const Str* const this
};
</code></pre></li>
</ul>
</li>
</ul>
</li>
<li>成员函数的名称查找与隐藏关系
<ul>
<li>函数内部（包括形参名称）隐藏函数外部</li>
<li>类内部名称隐藏类外部名称</li>
<li>使用this或域操作符引入依赖型名称查找(::x表示全局变量x)</li>
</ul>
</li>
<li>静态成员函数
<ul>
<li>用于描述与类紧密相关，但又不需要一个对象实例就可以调用的函数</li>
<li>被所有该类型对象所共享</li>
<li>在调用该函数的时候，不会隐式传入this指针了</li>
<li>因为上一条特性，所以它不能调用一般成员变量，但可以返回静态的数据成员</li>
</ul>
</li>
<li>成员函数基于引用限定符的重载(C++11)
<pre tabindex="0"><code>class Type {
  void foo() &amp;;
  void foo() &amp;&amp;;
  void foo() const &amp;;
  void foo() const &amp;&amp;;
};

int main() {
  Type obj;
  obj.foo();  // void foo() &amp;;
  Type().foo();  // void foo() &amp;&amp;;
}
</code></pre></li>
</ul>
</li>
</ul>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://xwlu.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://xwlu.github.io/css/toc.css' />

  
<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='https://xwlu.github.io/css/gitalk.css'>
<script src='https://xwlu.github.io/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    clientID: '',
    clientSecret: '',
    repo: '',
    owner: '',
    admin: [''],
    id: eval( null ), 
    distractionFreeMode: false 
  });
  (function() {
    gitalk.render('gitalk-container');
  })();
</script>

</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://xwlu.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
      <li class="mr-3 mr-lg-0">GitHub and the Invertocat logo are trademarks of <a href="https://github.com/">GitHub, Inc.</a></li>
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>

</body>

<script type="application/javascript" src="https://xwlu.github.io/js/github-style.js"></script>







</html>