<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://xwlu.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://xwlu.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/light.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/syntax.css' />
    <title>Construction of Class - 朝花夕拾</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">

    <link rel="stylesheet" href="https://xwlu.github.io/css/custom.css">
    <script type="text/javascript" src="https://xwlu.github.io/js/custom.js"></script>

    
    <meta name="description"
  content="construction for C&#43;&#43; class" />
<meta name="keywords"
  content='blog, robotics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://xwlu.github.io/post/languages/c&#43;&#43;/class/construct/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Construction of Class - 朝花夕拾" />
<meta name="twitter:description"
  content="construction for C&#43;&#43; class" />
<meta name="twitter:site" content="https://xwlu.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://xwlu.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Construction of Class - 朝花夕拾">
<meta property="og:description"
  content="construction for C&#43;&#43; class" />
<meta property="og:url" content="https://xwlu.github.io/post/languages/c&#43;&#43;/class/construct/" />
<meta property="og:site_name" content="Construction of Class" />
<meta property="og:image"
  content="https://xwlu.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2025-04-02 10:32:39 &#43;0800 CST" />











</head>


<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://xwlu.github.io/">
        <img class="octicon" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://xwlu.github.io/">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://xwlu.github.io/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://xwlu.github.io/">
                  <img class=" avatar-user"
                    src="/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://xwlu.github.io/">looyifan</a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="https://xwlu.github.io/post/languages/c&#43;&#43;/class/construct/">Construction of Class</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Wed, 02 Apr 2025 10:32:39 &#43;0800"
                    class="no-wrap">
                    Wed, 02 Apr 2025 10:32:39 &#43;0800</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Thu, 03 Apr 2025 17:15:09 &#43;0800"
                    class="no-wrap">
                    Thu, 03 Apr 2025 17:15:09 &#43;0800</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      2452 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="构造函数">构造函数</h1>
<ul>
<li>代理构造函数(C++11)</li>
<li>初始化列表
<ul>
<li>提高代码性能</li>
<li>类中的引用成员必须使用初始化列表进行初始化</li>
<li>类成员的初始化顺序与声明的顺序一致，与其在初始化列表中的顺序无关
<pre tabindex="0"><code>class Str {
public:
  Str(size_t input):y(input), x(y + 1) {
    std::cout &lt;&lt; x &lt;&lt; &#34; &#34; &lt;&lt; y &lt;&lt; std::endl;
  }
private:
  size_t x;
  size_t y;
};
// 打印结果是：4199057 4
// 因为x和y的初始化顺序是先初始化x，再初始化y，而初始化x时，y还没被初始化，所以y+1的结果是个随机值
</code></pre></li>
<li>使用初始化列表可以覆盖类内成员初始化的行为</li>
</ul>
</li>
<li>缺省构造函数：不需要提供实际参数就可以调用的构造函数
<ul>
<li>如果类内没有提供任何构造函数，在条件允许的情况下，编译器会合成一个缺省构造函数
<ul>
<li>如果类内有构造函数，编译器就不会合成缺省构造函数了</li>
<li>如果类内有引用成员变量，编译器也不会合成缺省构造函数</li>
</ul>
</li>
<li>调用缺省构造函数时避免most vexing parse
<pre tabindex="0"><code>struc Str {
  int x;
};
int main() {
  Str m;  // 合法
  Str m();  // 不合法，编译器会把这行当作一个函数声明
  Str m{};  // 合法
  std::cout &lt;&lt; m.x &lt;&lt; std::endl;
}
</code></pre></li>
<li>使用default关键字定义缺省构造函数
<ul>
<li>当我们在类内定义了一个带参数的构造函数后，编译器不会自动合成缺省构造函数了，这时候我们可以用Str() = default;来自己构造一个</li>
</ul>
</li>
</ul>
</li>
<li>单一构造函数
<ul>
<li>可以是为一种类型转换函数
<pre tabindex="0"><code>struct Str {
public:
  Str(int x) : val(x) {}
private: 
  int val;
};

void fun(Str m) {}

int main() {
  Str m(3);  // 合法
  Str m{3};  // 合法
  Str m = 3;  // 合法
  fun(3);  // 合法，发生了隐式类型转换 
}
</code></pre></li>
<li>explict关键字避免求值过程中的隐式类型转换
<pre tabindex="0"><code>struct Str {
public:
  explict Str(int x) : val(x) {}
private: 
  int val;
};

void fun(Str m) {}

int main() {
  Str m(3);  // 合法
  Str m{3};  // 合法
  Str m = 3;  // 不合法，explict起作用了
  fun(3);  // 不合法，explict起作用了
}
</code></pre></li>
</ul>
</li>
<li>拷贝构造函数
<ul>
<li>会在涉及到拷贝初始化的场景被调用，比如：参数传递。因此需要注意拷贝构造函数的形参类型
<ul>
<li>拷贝构造函数需要传入引用，最好再加上const</li>
<li>如果不传引用，首先需要将实参拷贝给形参，就需要调用拷贝构造函数，而拷贝构造函数正在被定义中，就无限嵌套了</li>
</ul>
</li>
<li>如果未显式提供，编译器会自动合成一个，合成版本会依次对每个数据成员调用拷贝构造函数，因此拷贝构造函数也可以使用default来构造</li>
</ul>
</li>
<li>移动构造函数(C++11)：接受一个当前类右值引用对象的构造函数
<pre tabindex="0"><code>std::string ori(&#34;abc&#34;);
std::string new_str = ori;  // 拷贝构造函数
std::cout &lt;&lt; ori &lt;&lt; &#34; &#34; &lt;&lt; new_str &lt;&lt; std::endl;  // abc abc

std::string new_str2 = std::move(ori);  // 移动构造函数
std::cout &lt;&lt; ori &lt;&lt; &#34; &#34; &lt;&lt; new_str2 &lt;&lt; std::endl;  //  abc
</code></pre><ul>
<li>自定义移动构造函数
<pre tabindex="0"><code>struc Str {
  // 构造函数
  Str() = default;
  Str(const Str&amp;) = default;
  Str(Str&amp;&amp; x) : val(x.val), a(std::move(x.a)) {};

  // void fun() {std::cout &lt;&lt; val &lt;&lt; &#34; &#34; &lt;&lt; a &lt;&lt; std::endl;}
  int val = 3;
  std::string a = &#34;abc&#34;;
};

int main() {
  Str m;
  m.fun();  // 3 abc 
  Str m2 = std::move(m);
  m.fun();  // 3
  m2.fun();  // 3 abc
}
</code></pre></li>
<li>缺省移动构造函数
<pre tabindex="0"><code>struct Str2 {
  Str2(const Str2&amp;);
};

struct Str {
  // 缺省构造
  Str() = default;
  // 拷贝构造
  Str(const Str&amp;) = default;
  // 移动构造
  Str(Str&amp;&amp;) = default;
  // 拷贝赋值
  Str&amp; operator= (const Str&amp; x) {
    std::cout &lt;&lt; &#34;copy assignment is called&#34; &lt;&lt; std::endl;
    val = x.val;
    a = x.a;
    return *this;
  }
  // 移动赋值
  Str&amp; operator= (Str&amp;&amp; x) {
    std::cout &lt;&lt; &#34;move assignment is called&#34; &lt;&lt; std::endl;
    val = std::move(x.val);
    a = std::move(x.a);
    return *this;
  }

  int val;
  std::string a;
  Str2 m_str2;
};

int main() {
  Str m;  // 编译失败
  // 因为Str2有拷贝构造函数了，编译器不会自动合成缺省构造函数，而Str的default构造函数又需要调用Str2的缺省构造函数，所以就报错了
  // 解决方案：在Str2类内加入&#34;Str2() = default;&#34;

  Str m2 = std::move(m);  //移动构造
  // 这里会依次对Str类的成员变量调用移动构造，由于Str2没有定义移动构造，所以会执行Str2的拷贝构造

  Str m3 = m;  // 拷贝构造

  Str m4;
  m4 = m;  // 拷贝赋值
  m4 = std::move(m);  // 移动赋值
}
</code></pre></li>
<li>移动构造函数通常声明为不可抛出异常函数：在函数声明的后面加上&quot;noexcept&quot;</li>
<li>注意右值引用对象用作表达式时是左值
<pre tabindex="0"><code>void fun(Str&amp;&amp; x) {
  std::cout &lt;&lt; x.val &lt;&lt; std::endl;  // 在这一行里面，x是个左值
}
</code></pre></li>
</ul>
</li>
<li>拷贝赋值函数(operator=)
<ul>
<li>代码如上</li>
<li>拷贝赋值不可以使用初始化列表</li>
<li>拷贝赋值函数通常返回该类型的引用
<ul>
<li>目的是为了支持&quot;m1=m2=m3;&ldquo;的使用方式</li>
<li>也可以返回void，比如把上面的&quot;return *this&quot;去掉，这样也可以赋值，但是不支持连等操作了</li>
</ul>
</li>
<li>一些情况下编译器会自动合成</li>
</ul>
</li>
<li>移动赋值函数
<ul>
<li>不可以使用初始化列表</li>
<li>通常返回该类型的引用</li>
<li>注意给自身赋值的情况
<pre tabindex="0"><code>struct Str {
  Str&amp; operator= (Str&amp;&amp; x) {
    if (&amp;x == this) {
      return *this;
    }
    delete ptr;
    ptr = x.ptr;
    x.ptr = nullptr;
  }

  int* ptr;
};

int main() {
  Str m1;
  m1 = std::move(m1);  // 如果没有一开始的if判断，这里会把m1的指针给搞成nullptr，显然不是我们想要的
}
</code></pre></li>
<li>一些情况下编译器会自动合成</li>
</ul>
</li>
</ul>
<hr>
<h1 id="析构函数">析构函数</h1>
<ul>
<li>无参数，无返回值，用于释放内存</li>
<li>内存回收是在析构函数执行完才进行</li>
<li>除非显示声明，否则编译器会自动合成一个，其内部逻辑为平凡的</li>
<li>析构函数通常不能抛出异常
<ul>
<li>因为C++在抛出异常的时候会把当前域内的数据都析构掉，如果析构过程又有新的异常，C++会直接退出，因为C++无法处理多个异常同时抛出的情况</li>
</ul>
<pre tabindex="0"><code>~Str() noexcept = default;
</code></pre></li>
</ul>
<hr>
<h1 id="相关注意点">相关注意点</h1>
<ul>
<li>通常来说，一个类
<ul>
<li>如果需要定义析构函数，那么也需要定义拷贝构造和拷贝赋值函数</li>
<li>如果需要定义拷贝构造函数，那么也需要定义拷贝赋值函数</li>
<li>如果需要定义拷贝构造（赋值）函数，那么也需要定义移动构造（赋值）函数</li>
</ul>
</li>
<li>default关键字
<ul>
<li>只对特殊成员函数有效（比如你只能对构造函数、析构函数等使用default方法）</li>
</ul>
</li>
<li>delete关键字
<ul>
<li>对所有函数都有效
<pre tabindex="0"><code>void fun(int) = delete;
void fun(double) { std::cout &lt;&lt; &#34;double is called&#34;; }

class Str {
public:
  Str() = default;
  ~Str() = delete;
private:
  int* ptr;
};

int main() {
  fun(3);  // 程序报错，因为根据名称查找规则，这里会调用void fun(int)，但是该函数是delete修饰的，不能被调用
  Str a;  // 程序报错，因为变量a在main函数执行结束后会被销毁，但析构函数是delete修饰的，不能被调用
  Str* p = new Str();  // 合法，因为new对象不会被自动销毁，所以不会调用析构函数，但是这么写是有内存泄漏的
  // 同时，如果主动调用delete p;，也无法通过编译
}
</code></pre></li>
<li>注意，不要为移动构造（赋值）函数引入delete限定符
<ul>
<li>如果只允许拷贝，那就引入拷贝构造即可</li>
<li>如果不需要拷贝，那就将拷贝构造声明为delete即可</li>
<li>注意delete移动构造（赋值）对C++17的新影响
<pre tabindex="0"><code>class Str {
public:
  Str() = default;
  Str(const Str&amp; val) = default;
  Str(Str&amp;&amp; val) = delete;
};

voidf fun(Str val) {}

int main() {
  fun(Str{});  // C++11会报错，因为传入了一个将亡值，会调用移动构造函数
  // C++17不会报错，因为C++17会优化掉移动构造这一步，这就导致同一份代码在不同环境下表现不一样了
}
</code></pre></li>
</ul>
</li>
</ul>
</li>
<li>特殊成员的合成行为列表（红色的表示支持但可能会废除的行为）
<ul>
<li><img src="/images/languages/C++/special-members.png" alt="special-members"></li>
<li>横着看，最左侧一栏表示如果用户声明了xxx，右边的表示系统的行为。</li>
<li>2014年的标准</li>
</ul>
</li>
</ul>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://xwlu.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://xwlu.github.io/css/toc.css' />

  
<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='https://xwlu.github.io/css/gitalk.css'>
<script src='https://xwlu.github.io/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    clientID: '8b0b3f1ab92d6a228c66',
    clientSecret: 'b6ca83c646ca6e48a78c2768b56fcf55470cc0c2',
    repo: 'xwlu.github.io',
    owner: 'xwlu',
    admin: ['xwlu'],
    id: eval("location.pathname"), 
    distractionFreeMode: false 
  });
  (function() {
    gitalk.render('gitalk-container');
  })();
</script>

</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://xwlu.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
      <li class="mr-3 mr-lg-0">GitHub and the Invertocat logo are trademarks of <a href="https://github.com/">GitHub, Inc.</a></li>
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>

</body>

<script type="application/javascript" src="https://xwlu.github.io/js/github-style.js"></script>







</html>