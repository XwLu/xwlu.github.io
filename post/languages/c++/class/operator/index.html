<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://xwlu.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://xwlu.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/light.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://xwlu.github.io/css/syntax.css' />
    <title>Operator - My New Hugo Site</title>
    
    <link rel="icon" type="image/x-icon" href='https://xwlu.github.io/images/favicon.ico'>
    
    <meta name="theme-color" content="#1e2327">

    
    

    
    <meta name="description"
  content="Operator for C&#43;&#43;" />
<meta name="keywords"
  content='' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://xwlu.github.io/post/languages/c&#43;&#43;/class/operator/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Operator - My New Hugo Site" />
<meta name="twitter:description"
  content="Operator for C&#43;&#43;" />
<meta name="twitter:site" content="https://xwlu.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://xwlu.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Operator - My New Hugo Site">
<meta property="og:description"
  content="Operator for C&#43;&#43;" />
<meta property="og:url" content="https://xwlu.github.io/post/languages/c&#43;&#43;/class/operator/" />
<meta property="og:site_name" content="Operator" />
<meta property="og:image"
  content="https://xwlu.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2025-04-02 10:32:39 &#43;0800 CST" />











</head>


<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://xwlu.github.io/">
        <img class="octicon" height="32" width="32" src="">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://xwlu.github.io/">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://xwlu.github.io/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://xwlu.github.io/">
                  <img class=" avatar-user"
                    src="https://xwlu.github.io/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://xwlu.github.io/"></a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="https://xwlu.github.io/post/languages/c&#43;&#43;/class/operator/">Operator</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Wed, 02 Apr 2025 10:32:39 &#43;0800"
                    class="no-wrap">
                    Wed, 02 Apr 2025 10:32:39 &#43;0800</relative-time>

                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      2643 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="运算符重载">运算符重载</h1>
<ul>
<li>使用operator关键字引入重载函数
<pre tabindex="0"><code>struct Str {
  int val = 3;

  auto operator () (int y = 3) {  // 只有operator () 可以有缺省参数
    return val + x;
  }

  auto operator + (const Str&amp; x) {
    Str res;
    res.val = val + x.val;
    return res;
  }
};

Str Add(const Str&amp; x, const Str&amp; y) {
  Str z;
  z.val = x.val + y.val;
  return z;
}

// auto自动推断返回值需要在C++11后面的版本才可以编译通过
auto operator + (const Str&amp; x, const Str&amp; y) {
  Str res;
  res.val = x.val + y.val;
  return res;
}

int main() {
  Str x;
  Str y;

  auto z = x + y;
  z = Add(x, y);

  z = x(4);  // z.val = 3 + 4
  z = x();  // z.val = 3 + 3
}
</code></pre><ul>
<li>重载不能发明新的运算(比如不能创造一个@运算符)，不能改变运算的优先级与结合性，通常不改变运算含义。</li>
<li>函数参数个数与运算操作数个数相同，至少一个为类类型</li>
<li>除operator()外其他运算符不能有缺省参数</li>
<li>可以选择实现为成员函数与非成员函数
<ul>
<li>通常来说，实现为成员函数会以*this作为第一个操作数(注意==与&lt;==&gt;的重载可以不需要*this作为第一个操作数)</li>
</ul>
</li>
</ul>
</li>
<li>根据重载特性，可以将运算符进一步划分
<ul>
<li>可重载且必须实现为成员函数的运算符(=,[],(),-&gt;与转型运算符)</li>
<li>可重载且可以实现为非成员函数的运算符</li>
<li>可重载但不建议重载的运算符(&amp;&amp;,||,逗号运算符)
<ul>
<li>C++17中规定了相应的求值顺序但没有方式实现短路逻辑(短路逻辑即:A&amp;&amp;B,如果A为非，B不用执行)</li>
</ul>
</li>
<li>不可重载的运算符(如 ?: 三元运算符)</li>
</ul>
</li>
<li>相对来说比较特殊的运算符重载
<ul>
<li>对称运算符通常定义为非成员函数以支持首个操作数的类型转换
<pre tabindex="0"><code>// 错误示范
struct Str {
  Str(int x) : val(x) {}
  auto operator + (const Str&amp; input) {
    return Str(val + input.val);
  }
  int val;
};

int main() {
  Str x(3);
  Str y = x + 4;  // 通过，4会隐式转换为Str(4)
  Str z = 4 + x;  // 不通过，最好不要将称运算符定义为成员函数
}
</code></pre><pre tabindex="0"><code>// 正确示范
struct Str {
  Str(int x) : val(x) {}

  Str&amp; operator= (const std::string&amp; input) {
    val = static_cast&lt;int&gt;(input.size());
    return *this;
  }

  // 定义为友元的原因是val是私有成员，而operator +是一个类外的运算符重载函数
  friend auto operator + (const Str&amp; input1, const Str&amp; input2) {
    return Str(input1.val + input2.val);
  }

  // 注意这里要返回引用，因为输出流是不支持拷贝的
  friend auto&amp; operator &lt;&lt; (std::ostream&amp; ostr, const Str&amp; input) {
    ostr &lt;&lt; input.val;
    return ostr;
  }

  int&amp; operator[] (int id) {  // func1
    return val;
  }

  int operator[] (int id) const {  // func2
    return val;
  }

private:
  int val;
};

int main() {
  Str x = 3;
  x = &#34;1234&#34;;
  Str y = 4 + x;  // 合法，我们在类外定了operator + (const Str&amp;, const Str&amp;)函数，4会被隐式转换为Str(4)
  std::cout &lt;&lt; x &lt;&lt; y;  // 合法

  std::cout &lt;&lt; x[0];  // 合法
  x[0] = 1;  // 如果func1不是返回的引用，就不合法，因为右值一般不能出现在等号左边

  const Str cx = 3;
  std::cout &lt;&lt; cx[0];  // 如果没有定义func2，就不合法，因为func1没用const修饰，可能对类本身进行修改
}
</code></pre></li>
<li>移位运算符一定要定义为非成员函数，因为其首个操作数类型需要是流类型(如上面代码所示)</li>
<li>赋值运算符也可以接受一般参数，比如上面代码中传入了一个string。</li>
<li>operator []通常返回引用，某些情况下不返回引用，比如上面的func2</li>
<li>自增、自减运算符的前缀、后缀重载法
<pre tabindex="0"><code>Str&amp; operator++ () {  //如果()里是空的，对应前缀自增x++
  ++val;
  return *this;
}
Str operator++ (int) {  // 如果()里有个int变量，对应后缀自增++x，注意这里的()里面的变量没有任何意义，不会参与任何计算或者赋值
  Str tmp(*this);
  ++val;
  return tmp;
}
// 从上面的代码可以看出，能用前缀自增就用前缀，更加高效
</code></pre></li>
<li>使用解引用运算符(*)与成员访问运算符(-&gt;)模拟指针行为
<pre tabindex="0"><code>struct Str {
public:
  Str(int* p) : ptr(p) {}

  int&amp; operator * () {
    return *ptr;
  }

  Str* operator -&gt; () {
    return this;
  }

  int val = 5;

private:
  int* ptr;
};

int main() {
  int x = 100;
  Str ptr(&amp;x);
  std::cout &lt;&lt; *ptr &lt;&lt; std::endl;
  std::cout &lt;&lt; ptr-&gt;val &lt;&lt; std::endl;
  // C++编译的时候遇到-&gt;就会去查看有没有operator-&gt;重载，如果有重载的话，就把它当作一个类成员函数去调用
  // 所以ptr-&gt;val会被翻译为：ptr.operator-&gt;()-&gt;val，其中ptr.operator-&gt;()的返回值就是一个Str*类型的指针
}
</code></pre><ul>
<li>注意，&quot;.&ldquo;运算符不能重载</li>
<li>&ldquo;-&gt;&ldquo;会递归调用&rdquo;-&gt;&ldquo;操作
<pre tabindex="0"><code>struct Str2 {
  Str2* operator -&gt; () {
    return this;
  }

  int val2 = 123;
};

struct Str {
  Str2 operator -&gt; () {
    return Str2{};
  }

  int val = 5;
};

int main() {
  Str ptr = Str();
  std::cout &lt;&lt; ptr-&gt;val2 &lt;&lt; std::endl;
  // 由于Str的operator-&gt;()函数返回的是Str2，不是一个指针类型，所以编译期还会继续调用Str2的operator-&gt;()函数，直到返回一个指针为止
  // ptr.operator-&gt;().operator()-&gt;val2
}
</code></pre></li>
</ul>
</li>
<li>使用函数调用运算符构造可调用对象(lambda表达式就是通过这个手段实现的)
<pre tabindex="0"><code>struct Str {
  Str(int p) : val(p) {}

  bool operator () (int input) {
    return val++ &lt; input;
  }

private:
  int val;
};

int main() {
  Str obj(100);
  std::cout &lt;&lt; obj(99) &lt;&lt; std::endl;  // 0
  std::cout &lt;&lt; obj(102) &lt;&lt; std::endl;  // 1
  std::cout &lt;&lt; obj(102) &lt;&lt; std::endl;  // 0, 因为val++
}
</code></pre></li>
<li>类型转换运算符
<ul>
<li>函数声明为operator type() const
<pre tabindex="0"><code>struct Str {
  Str(int p) : val(p) {}

  operator int() const {
    return val;
  }

  friend auto operator + (Str a, Str b) {
    return Str(a.val + b.val);
  }

private:
  int val;
};

int main() {
  Str obj(100);
  static_cast&lt;Str&gt;(100);  // 通过
  static_cast&lt;int&gt;(obj);  // 通过
  int v = obj;  // 通过
  std::cout &lt;&lt; v &lt;&lt; std::endl;

  obj + 3;  // 不通过，编译器既可以选择把obj转为int再相加，也可以把3转换为Str类型再相加（上面实现了Str的+友元重载）
  // 解决方案就是在Str的构造函数或者型转换运算符重载函数前面加上explicit关键字
  // 如果在构造函数前加explicit，3就不能隐式转换为Str类型了
  // 注意，不能两个函数前同时加上explicit，如果都加了也编译不过，因为没有任何隐式转换发生的话，Str和int无法执行+。

  // 如果在两个函数前同时加上explicit，代码就要这么改
  obj + static_cast&lt;Str&gt;(3);
  static_cast&lt;int&gt;(obj) + 3;
}
</code></pre></li>
<li>与单参数构造函数一样，都引入了一种类型转换方式</li>
<li>注意避免引入歧义性与意料之外的行为
<ul>
<li>通过explicit引入显示类型转换(参考上面的代码)</li>
</ul>
</li>
<li>explicit bool的特殊性：用于条件表达式时会进行隐式类型转换
<pre tabindex="0"><code>struct Str {
  explicit Str(int p) : val(p) {}

  explicit operator bool() const {
    return val == 0;
  }

private:
  int val;
};

int main() {
  Str obj(100);    
  std::cout &lt;&lt; obj &lt;&lt; std::endl;  // 不通过，因为上面有explicit修饰，不能隐式转换了

  if (obj) {  // 通过，即使定义了explicit，但这里仍然会进行隐式类型转换
    std::cout &lt;&lt; 1 &lt;&lt; std::endl;
  } else {
    std::cout &lt;&lt; 0 &lt;&lt; std::endl;
  }

  auto var = obj ? 1 : 0;  // 通过
  std::cout &lt;&lt; var &lt;&lt; std::endl;
}
</code></pre></li>
</ul>
</li>
<li>C++20中对==与&lt;==&gt;的重载
<ul>
<li>在C++20之前，如果我们想重载大小比较，我们需要实现6个重载，==, !=, &gt;=, &lt;=, &gt;, &lt;。</li>
<li>在C++20之后，只需要重载==, &lt;==&gt;这两个就可以完成对上面6个功能的定义</li>
<li>通过==定义!=</li>
<li>隐式交换操作数
<pre tabindex="0"><code>#include &lt;compare&gt;
struct Str {
  Str(int p) : val(p) {}

  friend bool operator == (Str obj, int obj2) {
    return obj.val == obj2;
  }

  auto operator &lt;==&gt; (int x) {
    return val &lt;==&gt; x;
  }

private:
  int val;
};

int main() {
  Str obj(100);
  std::cout &lt;&lt; (obj == 100) &lt;&lt; std::endl;
  std::cout &lt;&lt; (obj != 100) &lt;&lt; std::endl;  // C++20之后通过
  std::cout &lt;&lt; (100 == obj) &lt;&lt; std::endl;  // C++20之后通过，C++20会先尝试找(int, Str)，如果找不到会继续找(Str, int)

  std::cout &lt;&lt; (100 &gt;= obj) &lt;&lt; std::endl;
  std::cout &lt;&lt; (obj &gt;= 100) &lt;&lt; std::endl;
}
</code></pre></li>
<li>通过&lt;==&gt;定义多种比较逻辑(参考上main的代码)
<ul>
<li>注意&lt;==&gt;可以返回的类型，strong_ordering, weak_ordering, partial_ordering</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://xwlu.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://xwlu.github.io/css/toc.css' />

  
</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://xwlu.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
      <li class="mr-3 mr-lg-0">GitHub and the Invertocat logo are trademarks of <a href="https://github.com/">GitHub, Inc.</a></li>
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>

</body>

<script type="application/javascript" src="https://xwlu.github.io/js/github-style.js"></script>







</html>